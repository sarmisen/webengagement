<!doctype html>
<html>
<head>
<meta charset="utf-8">
<title>Untitled Document</title>

<link href='http://fonts.googleapis.com/css?family=Arapey' rel='stylesheet' type='text/css'>
<link href="css/reset.css" rel="stylesheet" type="text/css">
<link href="css/estilos.css" rel="stylesheet" type="text/css">
</head>
<body>
<div id="contenedor">
    <div id="cabecera">
    	<img src="imgs/comunes/titulo-guia.png" width="1000" height="345" />
    </div>
    <div id="fotograma1" class="contFoto">
        <div id="capa10"></div>
        <div id="capa11" class="extendido"></div>
        <div id="capa12"></div>
        <div id="capa13" class="extendido"></div>
        <div id="capa14"></div>
        <div id="capa15" class="extendido"></div>
        <div id="capa16"></div>
        <div id="capa17"></div>
        <div id="capa18"></div>
    </div>
    <div id="primerTexto" class="textos">
     <div class="container">	
        <p><img src="imgs/letras/T.png" />u misión es conseguir el Engagement, un misterioso amuleto que cambia de forma y se encuentra escondido en el fondo de un baúl dentro de un castillo inexpugnable. Para hacerte con él tendrás que tomar diferentes decisiones: unas te permitirán avanzar y desbloquear textos, otras te harán perder tus opciones de conseguir tu objetivo.</p>
        </div>
    </div>
    <div id="fotograma2" class="contFoto">
        <div class="capa20"></div>
        <div class="capa205"></div>
        <div class="capa23"></div>
        <div class="capa24"></div>
        <div class="capa25 extendido"></div>
        <div class="capa26 extendido"></div>
    </div>
    <div id="opcion1" class="textos">
         <div class="container">	
            <p><img src="imgs/letras/P.png" />rotegiendo el castillo te encuentras un foso lleno de historias.</p>
         </div>
         <div class="respuestaA">
            <div class="letra"><img src="imgs/letras/botonA.png"></div>
            <div class="textos doslineas">Decides lanzarte a él<br>y atravesarlo nadando.</div>
            <div style="clear: both;"></div>
         </div>
         <div class="respuestaB">
            <div class="letra"><img src="imgs/letras/botonB.png"></div>
            <div class="textos">Construyes una balsa<br>con tu porpia historia<br>para intentar cruzarlo</div>
            <div style="clear: both;"></div>
         </div>
         <div style="clear: both;"></div>
	</div>
    <div id="contRespuesta1">
        <div id="contRespuesta1A">
            <div id="respuesta1A">
                <div class="contFoto">
                    <div class="capa20"></div>
                    <div class="capa205"></div>
                    <div class="capa23"></div>
                    <div class="capa24"></div>
                    <div class="capa27"></div>
                </div>
             </div>
            <div class="respuestaErronea">
                <div>
                    <img src="imgs/comunes/demonio-final-sin-solucion.png" />
                    <br />Vuelve a intentarlo<br><span>pulsando <a href="javascript:volver(1);void(0)">aquí</a></span>
                </div>
            </div>
        </div>
        <div id="contRespuesta1B">
            <div id="respuesta1B">
                <div class="contFoto">
                    <div class="capa20"></div>
                     <div class="capa205"></div>
                    <div class="capa23"></div>
                    <div class="capa24"></div>
                    <div class="capa27"></div>
                    <div class="capa28"></div>
                </div>
             </div>
        </div>
    </div>
</div>
<div style="height:2000px;" id="resto"></div>
<div id="debugger" style="position: absolute; width: 90%; height: 25px; background-color: black; padding: 5px; z-index:100; top: 0; left: 0; color: orange;"></div>
</body>
 <script src="js/jquery-1.10.2.js"></script>
 <script type="text/javascript">
 var esChrome = false;
 // please note, that IE11 now returns true for window.chrome
var isChromium = window.chrome,
    vendorName = window.navigator.vendor;
if(isChromium !== null && vendorName === "Google Inc.") {
   // is Google chrome 
   esChrome = true;
}
var porcentaje = 1;
var altoInicial = 968;
var anchoInicial = 1720;
var extendidoInicial = 2019;
var alto;
var ancho;
var extendido;
var initF1;
var initF2;
var recorrido = 4000;
var altoVentana;
var anchoVentana;
var remanente = 0;
var initRespuesta1;
var initRespuesta2;
var initRespuesta3;
var initRespuesta4;
var initRespuesta5;
var finRespuesta1;
var finRespuesta2;
var finRespuesta3;
var finRespuesta4;
var finRespuesta5;
	 
 $(function() {
    $(document).on("mousewheel", function() {
        gestionaAnimacion($(document).scrollTop());
    });
	    $(document).on("scroll", function() {
        gestionaAnimacion($(document).scrollTop());
    });
	$("#debugger").css("top",$( window ).height()-$("#debugger").height());
	/// calculamos el alto de la pagina
	altoVentana = $(window).height();
	anchoVentana = $(window).width(); 
	porcentaje = $(window).width()/anchoInicial;
	//porcentaje = $(window).height()/altoInicial;
	porcentaje = porcentaje.toFixed(2);
	if (esChrome) {
		porcentaje = 1;
	}
	alto = Math.round(altoInicial * porcentaje);
	ancho = Math.round(anchoInicial * porcentaje);
	if (alto>altoVentana) {
		remanente = (alto-altoVentana)/2;
	}
	extendido = Math.round(extendidoInicial * porcentaje);
	recorrido = Math.round(recorrido * porcentaje);
	$("#resto").height(recorrido);
	///definimos los tamaños inciales: contenedores. imágenes,márgenes
	mensaje = "Porcentaje: " + porcentaje + " | Alto: " + alto + " |Ancho: " + ancho;
	$("#contenedor").css("width",ancho+"px");
	$("#cabecera").css("width",ancho+"px");
	$(".contFoto").css("width",ancho+"px");
	$(".contFoto").css("height",alto+"px");
	$("#debugger").html(mensaje);
	$(".contFoto div").css("width",ancho+"px");
	$(".contFoto div").css("height",alto+"px");
	$(".extendido").css("width",extendido+"px");
	$(".extendido").css("margin-left",0-((extendido-ancho)/2)+"px");
	$(".contFoto div:not(:first-child)").css("margin-top",0-(alto)+'px');
	
	/// contenedroes de textos	
	$(".textos .container").css("font-size",(porcentaje*1.2)+"em");
	$(".respuestaA").css("font-size",(porcentaje*1.2)+"em");
	$(".respuestaB").css("font-size",(porcentaje*1.2)+"em");
	$(".respuestaA").css("width",$(".textos").width()*0.22);
	$(".respuestaB").css("margin-left",$(".textos").width()*0.22);
	$(".respuestaA").css("margin-left",$(".textos").width()*0.25);
	$(".respuestaB").css("margin-left",$(".textos").width()*0.03);
	$(".doslineas").css("margin-top",$(".letra").width()*0.20);
	
	// click de los textos
	$("#opcion1 .respuestaA").click(function() {
		initRespuesta1 = $("#opcion1").offset().top + $("#opcion1").height() + (remanente*2);
		finRespuesta1 = initRespuesta1+recorrido;
		$("#contRespuesta1").show();
		$("#contRespuesta1A").show();
		$("#respuesta1A .capa27").css("margin-top",0);
	})
	$("#opcion1 .respuestaB").click(function() {
		initRespuesta1 = $("#opcion1").offset().top + $("#opcion1").height() + (remanente*2);
		finRespuesta1 = initRespuesta1+recorrido;
		$("#contRespuesta1").show();
		$("#contRespuesta1B").show();
		$("#respuesta1B .capa28").css("opacity",0);
	})	
	
/// control de los offsets inciales
	initF1 = $("#fotograma1").offset().top;
	initF2 = initF1+recorrido+$("#primerTexto").height();
	
	///escondemos 
	$("#contRespuesta1A").hide();
	$("#contRespuesta1B").hide();
	$(window).scrollTop(0); /// ponemos el scroll arriba;
});
function gestionaAnimacion (elscroll) {
	$("#debugger").css("top",$( window ).height()-25+elscroll);
	mensaje = "El Scroll: " + elscroll;
	mensaje += " | Scroll 1:" + (initF1-remanente) + " | Margen 1: " + $("#fotograma1").css("margin-top") ;
	mensaje += " | Scroll 2:" + initF2-(remanente*2) + " | Margen 2: " + $("#fotograma2").css("margin-top") ;
	F1Offset = $("#fotograma1").offset().top;
	initF2 = F1Offset+$("#fotograma1").height()+$("#primerTexto").height();
	mensaje += " | InitF2: " + initF2;
 	//mensaje += " | F1Offset: " + F1Offset + " | Recorrido " + recorrido + " | Texto Height:" + +$("#primerTexto").height() +  " |initF2: " + initF2;
	if (elscroll<=340) {
		$("#fotograma1").css("margin-top",0);
	}
	if (elscroll>(initF1+remanente) && elscroll<=initF1+recorrido) {
		mensaje = "Porcentaje " + porcentaje + " | Ancho: " + ancho;
		$("#fotograma1").css("margin-top",elscroll-(initF1+remanente));
		$("#capa17").css("width",ancho+(elscroll/25))
		$("#capa17").css("height",alto+(elscroll/35))
		$("#capa18").css("margin-top",0-($("#capa17").height()-3))
		$("#capa17").css("margin-left",0-(elscroll/50))
		$("#capa13").css("margin-left",0-(elscroll/5))
		$("#capa11").css("margin-left",(0-((extendido-ancho)/2)*porcentaje)+(elscroll/20))
		$("#capa15").css("margin-left",(0-((extendido-ancho)/2)*porcentaje)+(elscroll/25))
		//$("#capa17").css("opacity",1-(elscroll/2000));
		$("#fotograma2").css("margin-top",0);
		
	}
	if (elscroll>(initF2+(remanente*2)) && elscroll<=initF2+(remanente*2)+recorrido) {
		indice = elscroll % 2;
		mensaje += "Entramos en el frame 2";
		$("#fotograma2").css("margin-top",elscroll-(initF2+(remanente*2)));
		$("#fotograma2 .capa23").css("margin-top",0-(alto)+(indice*9));
		$("#fotograma2 .capa24").css("margin-top",0-(alto)+(indice*7));
		$("#fotograma2 .capa25").css("margin-left",(0-((extendido-ancho)/2))+((elscroll-(initF2+(remanente*2)+recorrido))/5))
		$("#fotograma2 .capa26").css("margin-left",(0-((extendido-ancho)/2))-((elscroll-(initF2+(remanente*2)+recorrido))/5))
		$("#fotograma2 .capa25").css("margin-top",0-(alto+(alto*0.05)));
		$("#fotograma2 .capa26").css("margin-top",0-(alto+(alto*0.05)));
	}
	if ($("#contRespuesta1A").is(":visible") && (elscroll>initRespuesta1 && elscroll<=finRespuesta1)) { 
		indice = elscroll % 2;
		zambullida = (initRespuesta1+recorrido)-initRespuesta1;
		foco = elscroll-initRespuesta1;
		coeficiente = foco/recorrido;
		porcentajeR = coeficiente*100;
		mensaje = "Porecentaje: " + porcentajeR;
		valorHundimiento = Math.round(foco/3);
		mensaje += " | Foco: " + foco;
		$("#respuesta1A").css("margin-top",elscroll-(initRespuesta1));
		$("#respuesta1A .capa23").css("margin-top",0-((alto+valorHundimiento)+(indice*3)));
		$("#respuesta1A .capa24").css("margin-top",0-(alto)+(indice*7));
		$("#respuesta1A .capa205").css("margin-left",0-(valorHundimiento));
		$("#respuesta1A .capa205").css("margin-top",0-(alto-(valorHundimiento)));
		$("#respuesta1A .capa27").css("margin-top",0-(alto*coeficiente));
	}
	if ($("#contRespuesta1B").is(":visible") && (elscroll>initRespuesta1 && elscroll<=finRespuesta1)) { 
		indice = elscroll % 2;
		foco = elscroll-initRespuesta1;
		coeficiente = foco/recorrido;
		porcentajeR = coeficiente*100;
		mensaje = "Porecentaje: " + porcentajeR;
		$("#respuesta1B").css("margin-top",elscroll-(initRespuesta1));
		$("#respuesta1B .capa23").css("margin-top",0-(alto)+(indice*9));
		$("#respuesta1B .capa24").css("margin-top",0-(alto)+(indice*7));
		if (porcentajeR>0 && porcentajeR<=20) {
			nCoeficiente = porcentajeR/20;
			$("#respuesta1B .capa205").css("opacity",1-nCoeficiente);
			$("#respuesta1B .capa28").css("opacity",nCoeficiente);
			mensaje = "| Coeficiente: " + nCoeficiente;
		}
		if (porcentajeR>40) {
			nCoeficiente = (porcentajeR-40)/60;
			$("#respuesta1B .capa28").css("margin-left",0-(ancho*nCoeficiente));
			mensaje = "| Coeficiente: " + nCoeficiente + ' |Mover: ' + (0-(ancho*nCoeficiente)) ;
			if (porcentajeR>80) {
				sCoeficiente = (porcentajeR-80)/10;
				$("#respuesta1B .capa28").css("opacity",1-sCoeficiente);
				mensaje = "Hacemos el fade | Coeficiente: " + sCoeficiente + ' |Mover: ' + (0-(ancho*nCoeficiente)) ;
			}
		}

	}
	$("#debugger").html(mensaje);
}
function volver (lugar) {
	total =  $("#opcion" + lugar).offset().top-($(window).height()-$("#opcion" + lugar).height());
	//alert('Lugar ' +$("#opcion" + lugar).offset().top + '\n' + 'Altura ventana: ' + $(window).height() + '\nAluta cinta' + $("#opcion" + lugar).height() + '\nTotal:' + total); 
	  $('html, body').animate({
        scrollTop: $("#opcion" + lugar).offset().top-(($(window).height()-$("#opcion" + lugar).height())/2)
    }, 2000, function () {
		$("#contRespuesta"+lugar).hide();
		$("#contRespuesta"+lugar+'A').hide();
		$("#contRespuesta"+lugar+'B').hide();
		});
}
 </script>
</html>
